<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>G!lashammer Racing Points</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>G!lashammer Racing Points</h1>
            <p id="tagline">Kannst Du mit Christian L. mithalten?</p>
            <button id="authBtn" class="auth-btn">🔐</button>
        </div>
        
        <div class="nav">
            <button class="nav-btn active" data-section="rankings">🏆 Ranglisten</button>
            <button class="nav-btn" data-section="history">📊 Historie</button>
            <button class="nav-btn" data-section="records">🏅 Hall of Fame</button>
            <button class="nav-btn admin-only" data-section="race">🏁 Neues Rennen</button>
            <button class="nav-btn admin-only" data-section="drivers">😎 Fahrer</button>
            <button class="nav-btn admin-only" data-section="cars">🏎️ Fahrzeuge</button>
        </div>

        <!-- Sub navigation for Rankings -->
        <div id="rankSubNav" class="sub-nav hidden">
            <button class="sub-tab active" data-rank="drivers">😎 Fahrer</button>
            <button class="sub-tab" data-rank="cars">🏎️ Fahrzeuge</button>
        </div>
        <!-- Sub navigation for Records -->
        <div id="recordSubNav" class="sub-nav hidden">
            <button class="sub-tab active" data-record="drivers">😎 Fahrer</button>
            <button class="sub-tab" data-record="cars">🏎️ Fahrzeuge</button>
        </div>
        
        <!-- Fahrer Section -->
        <div id="drivers" class="section">
            <h2>😎 Fahrer verwalten</h2>
            <div class="form-group">
                <label>Neuer Fahrer:</label>
                <div class="input-button-group">
                    <input type="text" id="newDriverName" placeholder="Name eingeben...">
                    <button class="btn" id="addDriverBtn">Hinzufügen</button>
                </div>
            </div>
            <div id="driversList"></div>
        </div>
        
        <!-- Fahrzeuge Section -->
        <div id="cars" class="section">
            <h2>🏎️ Fahrzeuge verwalten</h2>
            <div class="form-group">
                <label>Neues Fahrzeug:</label>
                <div class="input-button-group">
                    <input type="text" id="newCarName" placeholder="Fahrzeugname eingeben...">
                    <button class="btn" id="addCarBtn">Hinzufügen</button>
                </div>
            </div>
            <div id="carsList"></div>
        </div>
        
        <!-- Rennen Section -->
        <div id="race" class="section">
            <h2>🏁 Neues Rennen eingeben</h2>
            
            <div class="race-meta-grid" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Datum:</label>
                    <input type="date" id="raceDate">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Uhrzeit:</label>
                    <input type="time" id="raceTime">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Anzahl Runden:</label>
                    <input type="number" id="raceRounds" min="1" max="999" placeholder="z.B. 50">
                </div>
            </div>
            
            <div style="display:flex;gap:10px;margin-bottom:12px;">
               <button class="btn" id="setupRaceBtn">⚙️ Auto-Setup</button>
               <button class="btn" id="calculateRaceBtn">🏆 Rennen auswerten</button>
            </div>
            <h3 id="raceEntriesHeader" style="margin-top:0;margin-bottom:8px;">Rennen manuell eingeben (Platz 1 bis 6):</h3>
            <div id="raceEntries"></div>
        </div>
        
        <!-- Rankings Section -->
        <div id="rankings" class="section active">
            <div style="display:flex;gap:10px;justify-content:center;margin-bottom:15px;">
                <button class="btn rank-sub-btn active" data-rank="drivers">😎 Fahrer</button>
                <button class="btn rank-sub-btn" data-rank="cars">🏎️ Fahrzeuge</button>
            </div>
            <div id="driversRankWrapper">
            <div class="ranking-header">🏆 Fahrer-Rangliste</div>
            <div class="flex justify-between items-center" style="margin-bottom:10px;">
                <div></div>
                <button class="ranking-filter-btn">🔍 Filter</button>
            </div>
            <div id="driverPodium" class="podium"></div>
            <div id="driversRanking"></div>
            </div>
            
            <div id="carsRankWrapper" class="hidden">
                <div class="ranking-header" style="margin-top: 20px;">🏎️ Fahrzeug-Rangliste</div>
                <div class="flex justify-between items-center" style="margin-bottom:10px;">
                    <div></div>
                    <button class="ranking-filter-btn">🔍 Filter</button>
                  </div>
            <div id="carPodium" class="podium"></div>
            <div id="carsRanking"></div>
            </div>
        </div>

        <!-- Rekorde Section -->
        <div id="records" class="section">
            <div id="recordsHeader" class="ranking-header">🏅 Fahrzeug-Rekorde</div>

            <div id="recordForm" class="card admin-only" style="margin-bottom:20px;">
                <div class="form-group">
                    <label>Fahrzeug:</label>
                    <select id="recCarSel"></select>
                </div>
                <div class="form-group">
                    <label>Fahrer:</label>
                    <select id="recDriverSel"></select>
                </div>
                <div class="form-group">
                    <label>Bestzeit (Sekunden):</label>
                    <input type="number" id="recTime" step="0.001" min="0" placeholder="z. B. 7.352">
                </div>
                <div class="form-group">
                    <label>Datum:</label>
                    <input type="date" id="recDate">
                </div>
                <button class="btn" id="saveRecordBtn">Speichern</button>
            </div>

            <div id="recordPodium" class="podium"></div>

            <table class="record-table">
                <thead><tr id="recordsHead"></tr></thead>
                <tbody id="recordsBody"></tbody>
            </table>
        </div>
        
        <!-- Historie Section -->
        <div id="history" class="section">
            <div class="flex justify-between items-center" style="margin-bottom:10px;">
            <h2>📊 Renn-Historie</h2>
                <div style="display:flex;gap:8px;">
                    <button class="ranking-filter-btn" id="historyFilterBtn">🔍 Filter</button>
                    <button class="btn btn-danger admin-only" id="rebuildEloBtn">🔄 G!RP neu berechnen</button>
                </div>
            </div>
            <div id="raceHistory"></div>
        </div>

        <!-- G!RP Chart Modal -->
        <div id="eloModal" class="modal hidden">
            <div class="modal-content" style="max-width:600px;">
                <div class="modal-header">
                    <h3 id="eloModalTitle" style="margin:0;"></h3>
                    <div style="display:flex;gap:6px;">
                        <button class="mode-tab" id="modeEloBtn">G!RP</button>
                        <button class="mode-tab" id="modePosBtn">Rang</button>
                    </div>
                </div>
                <canvas id="eloChart" width="560" height="320"></canvas>
                <div style="text-align:right;margin-top:15px;">
                    <button class="btn btn-danger" id="eloModalClose">Schließen</button>
                </div>
            </div>
        </div>

    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal hidden">
        <div class="modal-content">
            <h3 style="margin-bottom:10px;">Login</h3>
            <input type="email" id="loginEmail" placeholder="E-Mail" class="modal-input">
            <input type="password" id="loginPassword" placeholder="Passwort" class="modal-input">
            <div style="margin-top:15px;text-align:right;">
                <button class="btn" id="loginSubmitBtn">Login</button>
                <button class="btn btn-danger" id="loginCancelBtn">Abbrechen</button>
                        </div>
                    </div>
                </div>

    <!-- History Filter Modal -->
    <div id="filterModal" class="modal hidden">
        <div class="modal-content" style="max-width:420px;">
            <h3 style="margin-bottom:10px;">Filter</h3>
            <div style="max-height:320px;overflow:auto;margin-bottom:10px;">
                <strong style="display:block;margin-bottom:6px;">Fahrer</strong>
                <div id="filterDriverList" style="margin-bottom:12px;"></div>
                <strong style="display:block;margin-bottom:6px;">Fahrzeuge</strong>
                <div id="filterCarList"></div>
            </div>
            <div style="text-align:right;margin-top:15px;">
                <button class="btn" id="filterApplyBtn">Anwenden</button>
                <button class="btn btn-danger" id="filterCancelBtn">Abbrechen</button>
                        </div>
                    </div>
                </div>

    <!-- Ranking Filter Modal -->
    <div id="rankingFilterModal" class="modal hidden">
        <div class="modal-content" style="max-width:460px;">
            <h3 style="margin-bottom:10px;">Ranglisten-Filter</h3>
            <div style="margin-bottom:14px;">
                <strong style="display:block;margin-bottom:6px;">Mind. Rennen: <span id="minRacesVal">5</span></strong>
                <input type="range" id="minRacesSlider" min="1" max="15" step="1" value="5" list="ticks">
                <datalist id="ticks">
                    <option value="1"></option>
                    <option value="3"></option>
                    <option value="5"></option>
                    <option value="8"></option>
                    <option value="10"></option>
                    <option value="15"></option>
                </datalist>
            </div>
            <div id="rankingFilterList" style="max-height:300px;overflow:auto;margin-bottom:10px;"></div>
            <div style="text-align:right;margin-top:15px;display:flex;gap:8px;justify-content:flex-end;">
                <button class="btn btn-modal" id="rankingFilterApply">Anwenden</button>
                <button class="btn btn-modal" id="rankingFilterReset">Zurücksetzen</button>
                <button class="btn btn-danger btn-modal" id="rankingFilterCancel">Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Race Setup Modal -->
    <div id="raceSetupModal" class="modal hidden">
      <div class="modal-content" style="max-width:480px;">
        <div id="setupStep1">
          <h3 style="margin-bottom:10px;">Schritt 1: Fahrer wählen</h3>
          <div id="setupDriverList" style="max-height:320px;overflow:auto;margin-bottom:10px;"></div>
          <div style="text-align:right;margin-top:15px;display:flex;gap:8px;justify-content:flex-end;">
            <button class="btn" id="setupNextBtn" disabled>Weiter</button>
            <button class="btn btn-danger" id="setupCancelBtn">Abbrechen</button>
          </div>
        </div>
        <div id="setupStep2" class="hidden">
          <h3 style="margin-bottom:10px;">Schritt 2: Fahrzeuge wählen</h3>
          <div id="setupCarList" style="max-height:320px;overflow:auto;margin-bottom:10px;"></div>
          <div style="text-align:right;margin-top:15px;display:flex;gap:8px;justify-content:flex-end;">
            <button class="btn" id="setupBackBtn">Zurück</button>
            <button class="btn" id="setupFinishBtn" disabled>Fertig</button>
            <button class="btn btn-danger" id="setupCancelBtn2">Abbrechen</button>
            <button class="btn" id="setupLuckyWheelBtn">🎰 Glücksrad</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Glücksrad Modal -->
    <div id="wheelModal" class="modal hidden">
        <div class="modal-content" style="text-align:center;max-width:380px;">
            <h3 style="margin-top:0;">🎰 Fahrzeug-Glücksrad</h3>
            <canvas id="wheelCanvas" width="300" height="300" style="margin-bottom:10px;"></canvas>
            <div id="powerBarWrap" class="power-wrap"><div id="powerBar" class="power-bar"></div></div>
            <div style="display:flex;gap:10px;justify-content:center;">
                <button class="btn" id="spinBtn">Drehen</button>
                <button class="btn btn-danger" id="wheelCloseBtn">Abbrechen</button>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <p>Version 1.5.4 · Copyright © 2025 by Tris · Nur für den privaten G!brauch</p>
        <p>Contact &amp; Donations (Paypal): rennstall@saeuferleber.de</p>
    </footer>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

    <!-- Chart.js für Graphen -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- Projekt-eigene Firebase-Initialisierung -->
    <script src="firebase.js"></script>

    <!-- Storage-Wrapper (Firestore CRUD) -->
    <script src="storage.js"></script>

    <!-- Hilfs-Module -->
    <script src="helpers.js"></script>
    <script src="elo.js"></script>

    <!-- Haupt-App-Logik -->
    <script src="app.js" defer></script>
    <script src="ranking.js" defer></script>
    <script src="race.js" defer></script>
    <script src="history.js" defer></script>
    <script src="records.js" defer></script>
    <script src="wheel.js" defer></script>
</body>
</html>